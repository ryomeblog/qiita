<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.tmpSpringBoot.dao.UserMstMapperImpl">
  <resultMap id="default" type="com.example.tmpSpringBoot.dto.generator.UserMst">
    <id column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="password" jdbcType="VARCHAR" property="password" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="secret_id" jdbcType="VARCHAR" property="secretId" />
    <result column="secret_answer" jdbcType="VARCHAR" property="secretAnswer" />
    <result column="error_password" jdbcType="SMALLINT" property="errorPassword" />
    <result column="lock" jdbcType="BIT" property="lock" />
    <result column="authority" jdbcType="SMALLINT" property="authority" />
    <result column="update_datetime" jdbcType="DATE" property="updateDatetime" />
    <result column="version" jdbcType="SMALLINT" property="version" />
  </resultMap>

  <select id="selectByUserId" resultMap="default" parameterType="java.lang.String">
    SELECT
      *
    FROM
      user_mst
    WHERE
      user_id = #{userId}
    ;
  </select>

  <select id="selectMaxUserId" resultType="java.lang.String">
    SELECT
      MAX(user_id) as user_id
    FROM
      user_mst
    ;
  </select>

  <select id="selectUserListCount" resultType="java.lang.Integer">
    SELECT
      COUNT(*)
    FROM
      user_mst
    WHERE
      0 = 0
    <if test = "userId != null">
      AND user_id = #{userId}
    </if>
    <if test = "userName != null">
      AND user_name LIKE CONCAT('%', #{userName}, '%')
    </if>
    <if test = "authority != null">
      AND authority = #{authority}
    </if>
    ;
  </select>

  <select id="selectUserList" resultMap="default">
    SELECT
      *
    FROM
      user_mst
    WHERE
      0 = 0
    <if test = "userId != null">
      AND user_id = #{userId}
    </if>
    <if test = "userName != null">
      AND user_name LIKE CONCAT('%', #{userName}, '%')
    </if>
    <if test = "authority != null">
      AND authority = #{authority}
    </if>
    ORDER BY
    <if test="orderBy == 1">
      user_id
    </if>
    <if test="orderBy == 2">
      user_name
    </if>
    <if test="orderBy == 3">
      authority
    </if>
    <if test="ascOrDesc == 1">
      ASC
    </if>
    <if test="ascOrDesc == 2">
      DESC
    </if>
    LIMIT
      #{limit}
    OFFSET
      #{offset}
    ;
  </select>

  <update id="updateUser" parameterType="com.example.tmpSpringBoot.dto.generator.UserMst">
    UPDATE
      user_mst
      <set>
        <if test="password != null">
          password = #{password},
        </if>
        <if test="userName != null">
          user_name = #{userName},
        </if>
        <if test="authority != null">
          authority = #{authority},
        </if>
        <if test="errorPassword != null">
          error_password = #{errorPassword},
        </if>
        <if test="lock != null">
          lock = #{lock},
        </if>
        <if test="updateDatetime != null">
          update_datetime = #{updateDatetime},
        </if>
        version = #{version} + 1
      </set>
    WHERE
      user_id = #{userId}
    ;
  </update>

  <update id="updatePassword" parameterType="com.example.tmpSpringBoot.dto.generator.UserMst">
    UPDATE
      user_mst
      <set>
        <if test="password != null">
          password = #{password},
        </if>
        <if test="updateDatetime != null">
          update_datetime = #{updateDatetime},
        </if>
        version = #{version} + 1
      </set>
    WHERE
      user_id = #{userId}
    ;
  </update>

  <delete id="deleteUser" parameterType="java.lang.String">
    DELETE FROM user_mst WHERE user_id = #{userId} ;
  </delete>

</mapper>
